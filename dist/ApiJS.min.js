!function(a,b,c,d,e,f){b("Api",function(b,f){f("Api",function(){return{properties:{factory:["object"]},methods:{service:function(a,b){return"undefined"==typeof b||"[object Array]"===Object.prototype.toString.call(b)?this.getFactory().createService(this,a,b):(this.getFactory().setServiceMeta(this,a,b),this)}}}}),f("Factory",function(a){return{constants:{META:{SERVICE:"Api.Service",ACTION:"Api.Action"}},properties:{serviceClazz:["clazz"],actionClazz:["clazz"],serviceMeta:["hash"],actionMeta:["hash"]},methods:{createService:function(b,c,d){var e=this.getServiceClazz().create({name:c,api:b}),f=this.getServiceMeta(b,c);return"function"==typeof f&&(f=f.apply(e,d)),a.processor(this.clazz.const("META")("SERVICE")).process(e,f),e},createAction:function(b,c,d){var e=this.getActionClazz().create({name:c,service:b}),f=this.getActionMeta(b,c);return"function"==typeof f&&(f=f.apply(e,d)),a.processor(this.clazz.const("META")("ACTION")).process(e,f),e},getServiceMeta:function(a,b){return this.__getPropertyValue("serviceMeta",this.getServiceMetaName(a,b))},setServiceMeta:function(a,b,c){return this.__setPropertyValue("serviceMeta",this.getServiceMetaName(a,b),c)},hasServiceMeta:function(a,b){return this.__hasPropertyValue("serviceMeta",this.getServiceMetaName(a,b))},getServiceMetaName:function(a,b){return"Api"+a.uid+"___"+b},getActionMeta:function(a,b){return this.__getPropertyValue("actionMeta",this.getActionMetaName(a,b))},setActionMeta:function(a,b,c){return this.__setPropertyValue("actionMeta",this.getActionMetaName(a,b),c)},hasActionMeta:function(a,b){return this.__hasPropertyValue("actionMeta",this.getActionMetaName(a,b))},getActionMetaName:function(a,b){return a.getName()+"___"+b}}}}),f("Service",function(){return{properties:{api:["object"],name:["string"],baseUrl:["string"],header:["hash"],data:["hash"],param:["hash"],option:["hash"],processors:["hash",{keys:["pre","success","fail","post"]}]},methods:{action:function(a,b){return this.getApi().getFactory().createAction(this,a,b)}}}}),f("Action",function(a,b){return{properties:{name:["string"],service:["object"],path:["string"],method:["string","GET",{pattern:/^(GET|POST|PUT|DELETE|PATCH)$/}],header:["hash"],data:["hash"],param:["hash"],option:["hash"],processors:["hash",{keys:["pre","success","fail","post"]}]},methods:{query:function(){var c=this;return a.when().then(function(){return c.process("pre")}).then(function(){return c.checkRequest(),a.when(b.ajax(c.getAjaxOptions()))}).then(function(){return c.process("success")}).fail(function(){return c.process("fail")}).fin(function(){return c.process("post")})},process:function(b){if(this.hasAllProcessors(b)){var c,d,e=[],f=this.getAllProcessors(b);for(c=0,d=f.length;d>c;++c)e.push(f[c].call(this));return a.all(e)}},getAllHeader:function(a){var b,c={},d=this.getHeader(),e=this.getService().getHeader();for(b in d)c[b]=d[b];for(b in e)c[b]=e[b];return"undefined"!=typeof a?c[a]:c},hasAllHeader:function(a){return a in this.getAllHeader()},getAllParam:function(a){var b,c={},d=this.getParam(),e=this.getService().getParam();for(b in d)c[b]=d[b];for(b in e)c[b]=e[b];return"undefined"!=typeof a?c[a]:c},hasAllParam:function(a){return a in this.getAllParam()},getAllData:function(a){var b,c={},d=this.getData(),e=this.getService().getData();for(b in d)c[b]=d[b];for(b in e)c[b]=e[b];return"undefined"!=typeof a?c[a]:c},hasAllData:function(a){return a in this.getAllData()},getAllProcessors:function(a){var b={},c=this.getService().getProcessors(),d=this.getProcessors(),e,f,g,h,i=["pre","success","fail","post"];for(g=0,h=i.length;h>g;++g){if(e={},i[g]in c)for(f in c)e[f]=c[f];if(i[g]in d)for(f in d[i[g]])e[f]=d[i[g]][f];for(f in e){b[i[g]]=e;break}}return"undefined"!=typeof a?b[a]:b},hasAllProcessors:function(a){return a in this.getAllProcessors()},getAllOption:function(a){var b,c={},d=this.getOption(),e=this.getService().getOption();for(b in d)c[b]=d[b];for(b in e)c[b]=e[b];return"undefined"!=typeof a?c[a]:c},hasAllOption:function(a){return a in this.getOption()},getAjaxOptions:function(){var a=this.getAllOption();return a.url=this.getUrl(),a.type=this.getMethod(),a.headers=this.getAllHeader(),a.data=this.getAllData(),a.processData=!1,a},getUrl:function(){var a,b=this.getAllParam(),c=[],d="/"+this.getService().getBaseUrl()+"/"+this.getPath();d=d.replace(/\/+/,"/");for(a in b)this.isParamInPath(a)?d=d.replace("{"+a+"}",b[a]):c.push("param="+b[a]);return c=c.join("&"),c&&(-1===d.search("?")?d+="?":"&"!==d[d.length-1]&&(d+="&"),d+=c),d},isParamInPath:function(a){return-1!==this.getPath().search("{"+a+"}")}}}}),c.processor("Api.Action","Meta.Options",{options:{path:"Api.Path",method:"Api.Method",headers:"Api.Headers",params:"Api.Params",data:"Api.Data",options:"Api.Options",processors:"Api.Processors"}}),c.processor("Api.Actions",function(a,b){for(var c in b)a.getApi().getFactory().setActionMeta(a,c,b[c])}),c.processor("Api.BaseUrl",function(a,b){a.setBaseUrl(b)}),c.processor("Api.Data",function(a,b){for(var c in b)a.setData(c,b[c])}),c.processor("Api.Headers",function(a,b){for(var c in b)a.setHeader(c,b[c])}),c.processor("Api.Method",function(a,b){a.setMethod(b)}),c.processor("Api.Options",function(a,b){for(var c in b)a.setOption(c,b[c])}),c.processor("Api.Params",function(a,b){for(var c in b)a.setParam(c,b[c])}),c.processor("Api.Path",function(a,b){a.setPath(b)}),c.processor("Api.Processors",function(a,b){for(var c in b)a.setProcessor(c,b[c])}),c.processor("Api.Service","Meta.Options",{options:{baseUrl:"Api.BaseUrl",headers:"Api.Headers",params:"Api.Params",data:"Api.Data",options:"Api.Options",processors:"Api.Processors",actions:"Api.Actions"}}),function(a,b,c,d,e){var f=b("Action",[d,e]),g=b("Service"),h=b("Factory",[c]),i=b("Api");a.api=i.create({factory:h.create({serviceClazz:g,actionClazz:f})})}(a,f,c,d,e)})}(this,namespace,meta,Q,jQuery);
//# sourceMappingURL=dist/ApiJS.min.map